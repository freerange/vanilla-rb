#!/usr/bin/env ruby

def create(new_app_dir)
  require 'fileutils'
  pristine_app = File.expand_path("../../pristine_app", __FILE__)
  FileUtils.cp_r(pristine_app, new_app_dir)
  require 'vanilla'
  File.open(File.join(new_app_dir, "Gemfile"), "w") do |f|
    f.write "source :rubygems\n\n# Vanilla itself.\ngem 'vanilla', '#{Vanilla::VERSION}'"
  end
  puts File.readlines(File.join(new_app_dir, "README"))[0..16].join
  FileUtils.cd(new_app_dir)
end

def console
  $LOAD_PATH << "lib"
  require "rubygems"
  require "bundler/setup"
  require "irb"
  require "vanilla/console"
  ARGV.clear
  puts "The Soup is simmering."
  IRB.start 
end

def upgrade
  # TODO
  puts "TODO, but should be easier thanks to multi-space soup."
end

case ARGV[0]
when "console"
  console
when "upgrade"
  upgrade
else
  create(ARGV[0])
end
